<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Product Listing</title>
      <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
      <link href="styles.css" rel="stylesheet">
   </head>
   <body>
      <nav class="navbar navbar-expand-lg navbar-dark">
         <a class="navbar-brand" href="#">Digital Mantraaz</a>
         <div class=" navbar-collapse">
            <ul class="navbar-nav ml-auto">
               <li class="nav-item active">
                  <a class="nav-link" href="index.html">Product Listing</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="cart.html">Cart (<span id="cart-count">0</span>)</a>
               </li>
            </ul>
         </div>
      </nav>
      <div class="m-0 m-md-4 filter-bar row">
         <div class="col-md-2 mob-line" style="border-right: 1px solid #ccc;">
            <div class="">
               <h5>Filters</h5>
               <label for="price-range">Price Range</label>
               <input type="range" id="price-range" min="0" max="500" step="1" class="form-control">
               <span id="price-range-value">$0</span>
               <label for="category-filter" class="mt-3">Category</label>
               <select id="category-filter" class="form-control">
                  <option value="">All Categories</option>
                  <option value="electronics">Electronics</option>
                  <option value="jewelery">Jewelry</option>
                  <option value="men clothing">Men's Clothing</option>
                  <option value="women clothing">Women's Clothing</option>
               </select>
            </div>
         </div>
         <div class=" col-md-10">
            <div class="container">
               <div class="row" id="product-grid"></div>
            </div>
            <div class="loading-spinner" id="loading-spinner">
               <div class="spinner"></div>
            </div>
         </div>
      </div>
      <button id="back-to-top">
      â†‘
      </button>
      <div class="toast" id="cart-notification">Item added to cart!</div>
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
      <script>
         document.addEventListener("DOMContentLoaded", function () {
           const dummyApiUrl = "https://fakestoreapi.com/products"; 
           
           let products = []; 
         
           const loadingSpinner = document.getElementById('loading-spinner');
           loadingSpinner.style.display = 'block'; 
           fetch(dummyApiUrl)
             .then(response => response.json())
             .then(data => {
               console.log('Products loaded successfully:', data);
               products = data;
               renderProducts(products);
               loadingSpinner.style.display = 'none'; 
             })
             .catch(error => {
               console.error('Error fetching products:', error);
               alert('Error loading products. Please check the console for details.');
               loadingSpinner.style.display = 'none'; 
             });
         
           function renderProducts(products) {
             const productGrid = document.getElementById("product-grid");
             productGrid.innerHTML = ''; 
             if (products.length === 0) {
               productGrid.innerHTML = "<div class='col-12'><p>No products found.</p></div>";
               return;
             }
         
             products.forEach(product => {
               const card = document.createElement("div");
               card.classList.add("col-md-3", "mb-4");
         
               card.innerHTML = `
                 <div class="card product-card">
                   <img src="${product.image}" alt="${product.title}" class="card-img-top">
                   <div class="card-body">
                     <h5 class="card-title">${product.title}</h5>
                     <p class="card-text">Rs.${product.price}</p>
                     <button class="btn btn-primary add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                   </div>
                 </div>
               `;
         
               card.querySelector(".add-to-cart-btn").addEventListener("click", function () {
                 addToCart(product.id);
               });
         
               productGrid.appendChild(card);
             });
           }
           const priceRange = document.getElementById("price-range");
           const priceRangeValue = document.getElementById("price-range-value");
           priceRange.addEventListener("input", function () {
             priceRangeValue.textContent = `$${priceRange.value}`;
             filterProducts();
           });
           const categoryFilter = document.getElementById("category-filter");
           categoryFilter.addEventListener("change", function () {
             filterProducts();
           });
           function filterProducts() {
             const selectedPrice = parseInt(priceRange.value);
             const selectedCategory = categoryFilter.value;
         
             const filteredProducts = products.filter(product => {
               const isPriceInRange = product.price <= selectedPrice;
               const isCategoryMatching = selectedCategory ? product.category.toLowerCase() === selectedCategory.toLowerCase() : true;
         
               return isPriceInRange && isCategoryMatching;
             });
         
             renderProducts(filteredProducts);
           }
         
           let cart = JSON.parse(localStorage.getItem("cart")) || [];
         
           function addToCart(productId) {
             const product = products.find(p => p.id === productId);
             cart.push(product);
             localStorage.setItem("cart", JSON.stringify(cart));
             updateCartNotification();
             updateCartCount();
           }
         
           function updateCartNotification() {
             document.getElementById("cart-notification").classList.add("show");
             setTimeout(() => {
               document.getElementById("cart-notification").classList.remove("show");
             }, 3000);
           }
         
           function updateCartCount() {
             document.getElementById("cart-count").textContent = cart.length;
           }
           const backToTopBtn = document.getElementById("back-to-top");
         
           window.onscroll = function () {
             if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
               backToTopBtn.style.display = "block";
             } else {
               backToTopBtn.style.display = "none";
             }
           };
           backToTopBtn.addEventListener("click", function () {
             window.scrollTo({ top: 0, behavior: "smooth" });
           });
         });
         
           
      </script>
   </body>
</html>